<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Tracker - Redstorm Modeling Agency</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; color: #333; }
        .input-section, .button-section { margin: 20px 0; }
        label { margin-right: 10px; font-weight: bold; }
        #weekPeriod, #newMemberName { width: 200px; padding: 5px; }
        select { padding: 5px; }
        button { padding: 8px 15px; margin: 5px; background-color: #4CAF50; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background-color: #45a049; }
        table { border-collapse: collapse; width: 100%; overflow-x: auto; display: block; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        td select { width: 50px; padding: 2px; }
        button.remove-btn { background-color: #f44336; }
        button.remove-btn:hover { background-color: #da190b; }
    </style>
</head>
<body>
    <h1>Attendance Tracker - Redstorm Modeling Agency</h1>
    <div class="input-section">
        <label for="weekPeriod">Week Period:</label>
        <input type="text" id="weekPeriod" placeholder="e.g., Dec 5 - Dec 12">
    </div>
    <div class="input-section">
        <label for="newMemberName">New Member Name:</label>
        <input type="text" id="newMemberName" placeholder="Enter name">
        <label for="newMemberTag">Tag:</label>
        <select id="newMemberTag">
            <option value="Model">Model</option>
            <option value="Officer">Officer</option>
        </select>
        <button onclick="addMember()">Add Member</button>
    </div>
    <table id="attendanceTable">
        <thead>
            <tr>
                <th>Member</th>
                <th>Tag</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
                <th>Sun</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="membersBody"></tbody>
    </table>
    <div class="button-section">
        <button onclick="downloadData()">Download Data</button>
        <input type="file" id="uploadFile" style="display: none;" onchange="uploadData(event)">
        <button onclick="document.getElementById('uploadFile').click()">Upload Data</button>
    </div>

    <script>
        let weekPeriod = "";
        let members = [];
        const weekInput = document.getElementById("weekPeriod");

        weekInput.onchange = function() {
            weekPeriod = this.value.trim();
        };

        function updateTable() {
            const tbody = document.getElementById("membersBody");
            tbody.innerHTML = "";
            if (members.length === 0) {
                tbody.innerHTML = "<tr><td colspan='10'>No members added yet.</td></tr>";
            } else {
                members.forEach((member, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${member.name}</td>
                        <td>${member.tag}</td>
                        ${member.attendance.map((status, day) => `
                            <td>
                                <select onchange="updateAttendance(${index}, ${day}, this.value)">
                                    <option value="❔" ${status === "❔" ? "selected" : ""}>❔</option>
                                    <option value="✅" ${status === "✅" ? "selected" : ""}>✅</option>
                                    <option value="☑️" ${status === "☑️" ? "selected" : ""}>☑️</option>
                                    <option value="❌" ${status === "❌" ? "selected" : ""}>❌</option>
                                </select>
                            </td>
                        `).join("")}
                        <td><button class="remove-btn" onclick="removeMember(${index})">Remove</button></td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        function addMember() {
            const name = document.getElementById("newMemberName").value.trim();
            const tag = document.getElementById("newMemberTag").value;
            if (!name) {
                alert("Please enter a member name.");
                return;
            }
            members.push({
                name: name,
                tag: tag,
                attendance: ["❔", "❔", "❔", "❔", "❔", "❔", "❔"],
                farewell: false
            });
            document.getElementById("newMemberName").value = "";
            updateTable();
        }

        function removeMember(index) {
            members.splice(index, 1);
            updateTable();
        }

        function updateAttendance(memberIndex, dayIndex, value) {
            members[memberIndex].attendance[dayIndex] = value;
        }

        function downloadData() {
            if (!weekPeriod) {
                alert("Please enter a week period before downloading.");
                return;
            }
            const data = { week: weekPeriod, members: members };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `Attendance_${weekPeriod}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function uploadData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (!data.week || !Array.isArray(data.members)) {
                        throw new Error("Missing week or members array.");
                    }
                    weekPeriod = data.week;
                    members = data.members.map(member => ({
                        name: member.name || "",
                        tag: member.tag || "Model",
                        attendance: Array.isArray(member.attendance) && member.attendance.length === 7 ? member.attendance : ["❔", "❔", "❔", "❔", "❔", "❔", "❔"],
                        farewell: !!member.farewell
                    }));
                    weekInput.value = weekPeriod;
                    updateTable();
                    alert("Data uploaded successfully!");
                } catch (err) {
                    alert("Invalid file format. Please upload a valid JSON file from 'Download Data'.");
                    console.error(err);
                }
            };
            reader.readAsText(file);
        }

        updateTable();
    </script>
</body>
</html>
